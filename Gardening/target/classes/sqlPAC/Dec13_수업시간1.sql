

-- 연습문제

SELECT * FROM ORG_TBL;

SELECT NO, ST_DT, ET_DT, NM
FROM ORG_TBL
ORDER BY NO;


SELECT NO
	, AA
	,  BB 
	, NM 
FROM 
( 
SELECT NO
		, DECODE(ST_DT || NM , ET_DT || NM,
		FIRST_VALUE(ST_DT) OVER(PARTITION BY NM ORDER BY ST_DT ROWS BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING), ST_DT)  AA
		, ET_DT BB
 	--	, DECODE(ST_DT || NM , ET_DT || NM,
	--	LAST_VALUE(ET_DT) OVER(PARTITION BY NM ORDER BY ET_DT ROWS BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING), ET_DT) BB
 		, NM 
FROM 
(
SELECT NO, ST_DT, ET_DT, NM
FROM ORG_TBL
ORDER BY NO
))
;


SELECT NO 번호
, ST_DT1 시작
, ET_DT1 종료
, NM 이름
FROM
(
SELECT NO
	, DECODE(LEAD_S, LAG_E, LEAD_S, ST_DT) ST_DT1
	, DECODE(LEAD_S, LAG_E, LAG_E, ET_DT) ET_DT1
	, NM
FROM
(
SELECT NO,
 ST_DT
 , ET_DT
 , LEAD(ST_DT) OVER(ORDER BY NM DESC) AS LEAD_S
 , LAG(ET_DT) OVER(ORDER BY NM DESC) AS LAG_E
 , NM
FROM ORG_TBL
ORDER BY NO )  )
;



SELECT NO,
 ST_DT
 , ET_DT
 , LEAD(ST_DT) OVER(ORDER BY NM DESC) AS LEAD_S
 , LAG(ET_DT) OVER(ORDER BY NM DESC) AS LAG_E
 , NM
FROM ORG_TBL
ORDER BY NO;